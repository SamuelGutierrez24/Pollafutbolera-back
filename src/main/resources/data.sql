
-- Eliminar y volver a crear las tablas necesarias
DROP TABLE IF EXISTS "pollas", "platform_configs", "tournaments", "rewards", "companies" CASCADE;

-- Volver a crear la tabla Tournaments
CREATE TABLE "tournaments" (
                               "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                               "name" VARCHAR(255) NOT NULL,
                               "description" TEXT,
                               "winner_team_id" INT NULL,
                               "fewest_goals_conceded_team_id" INT NULL,
                               "top_scoring_team_id" INT NULL,
                               "deleted_at" TIMESTAMP NULL
);

-- Volver a crear la tabla platform_config
CREATE TABLE "platform_configs" (
                                   "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                                   "tournament_champion" INT NOT NULL,
                                   "team_with_most_goals" INT NOT NULL,
                                   "exact_score" INT NOT NULL,
                                   "team_score" INT NOT NULL,
                                   "match_winner" INT NOT NULL,
                                   "subchampion" INT NOT NULL
);

-- Volver a crear la tabla Pollas
CREATE TABLE "pollas" (
                          "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                          "start_date" DATE NOT NULL,
                          "end_date" DATE NOT NULL,
                          "private" BOOLEAN NOT NULL,
                          "image_url" TEXT,
                          "company_id" INT NOT NULL,
                          "platform_config_id" INT NOT NULL,
                          "tournament_id" INT NOT NULL,
                          "deleted_at" TIMESTAMP NULL,
                          "color" VARCHAR(7) NOT NULL,
                          FOREIGN KEY ("platform_config_id") REFERENCES "platform_configs" ("id") ON DELETE CASCADE,
                          FOREIGN KEY ("tournament_id") REFERENCES "tournaments" ("id") ON DELETE CASCADE,
                          FOREIGN KEY ("company_id") REFERENCES "companies" ("id") ON DELETE CASCADE
);

CREATE TABLE "rewards" (
                          "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                          "polla_id" INT NOT NULL,
                          "name" varchar(255) NOT NULL,
                          "description" varchar(255) NULL,
                          "image" TEXT NULL,
                          "position" INT NULL,
                          "deleted_at" TIMESTAMP NULL,
                          FOREIGN KEY ("polla_id") REFERENCES "pollas" ("id") ON DELETE CASCADE
);

CREATE TABLE "companies" (
                            "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                            "name" VARCHAR(255) NOT NULL,
                            "nit" VARCHAR(255) NOT NULL
);

-- Insertar datos en Tournaments
INSERT INTO "tournaments" (id, name, description, winner_team_id, fewest_goals_conceded_team_id, top_scoring_team_id, deleted_at)
VALUES (1, 'Copa América 2024', 'Torneo de selecciones de América', NULL, NULL, NULL, NULL);

-- Insertar configuración de plataforma
INSERT INTO platform_configs (id, tournament_champion, team_with_most_goals, exact_score, team_score, match_winner, subchampion)
VALUES (1, 10, 5, 15, 8, 3, 7);

INSERT INTO companies (id, name, nit) VALUES (1, 'ICESI University', '12345678-9');

-- Insertar una polla
INSERT INTO "pollas" (id, start_date, end_date, private, image_url, company_id, platform_config_id, tournament_id, deleted_at, color)
VALUES (1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP + interval '7 days', FALSE, 'https://example.com/image.png', 1,1, 1, NULL, '#FF5733');

-- Insertar recompensas
INSERT INTO "rewards" (id, polla_id, name, description, image, position) VALUES (1, 1, 'Primer lugar', 'Gana la polla', 'https://example.com/image.png', 1);
INSERT INTO "rewards" (id, polla_id, name, description, image, position) VALUES (2, 1, 'Segundo lugar', 'segundo lugar en la polla', 'https://example.com/image.png', 2);
INSERT INTO "rewards" (id, polla_id, name, description, image, position) VALUES (3, 1, 'Tercer lugar', 'tercer lugar en la polla', 'https://example.com/image.png', 3);

-- Insertar Permisos
INSERT INTO "permissions" (ID, NAME) VALUES
    (1, 'READ'),
    (2, 'WRITE'),
    (3, 'UPDATE'),
    (4, 'DELETE');

-- Insertar Rol
INSERT INTO "roles" (ID, NAME) VALUES (1, 'ROLE_USER');

-- Asignar Permisos al Rol (tabla intermedia role_permission)
INSERT INTO permission_role (role_id, permission_id) VALUES
     (1, 1),  -- READ
     (1, 2),  -- WRITE
     (1, 3),  -- UPDATE
     (1, 4);  -- DELETE

-- Insertar Usuario de prueba (password = 'password' encriptado con BCrypt)
INSERT INTO "users" (ID, NAME, CEDULA, PASSWORD, MAIL, NICKNAME,  ROLE_ID) VALUES (
      1,
      'Usuario de Prueba',
      '123456789',
      'test.', -- password: 'password'
      'test@example.com',
      'test'

  );

